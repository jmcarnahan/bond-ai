graph TB
    %% ====================================================================================
    %% BOND AI RUNTIME SECURITY ARCHITECTURE
    %% ====================================================================================

    subgraph "Users & Authentication"
        USERS[End Users]
        OKTA[Okta SSO Identity Provider]
    end

    subgraph "AWS Account"
        subgraph "AWS VPC - Private Network"
            subgraph "Application Services"
                AR_BE[Backend App Runner<br/>Python FastAPI<br/>0.5 vCPU 1GB RAM]
                AR_FE[Frontend App Runner<br/>Flutter Web App<br/>0.25 vCPU 0.5GB RAM]
                AR_CONN[VPC Connector<br/>Private Network Bridge]
            end

            subgraph "Data & Storage"
                RDS[PostgreSQL RDS 15.7<br/>Encrypted GP3 Storage<br/>Multi-AZ Deployment]
                S3[S3 Uploads Bucket<br/>AES256 Encrypted<br/>Public Access Blocked]
                SM_SECRETS[AWS Secrets Manager<br/>DB Credentials & Okta Secrets<br/>JWT Keys]
            end

            subgraph "Network Security"
                SG_APPRUNNER[App Runner Security Group<br/>Egress to RDS & AWS APIs]
                SG_RDS[RDS Security Group<br/>Port 5432 from App Runner Only]
                VPC_S3[S3 VPC Gateway Endpoint<br/>Private Network Access]
            end

            subgraph "Container Registry"
                ECR[ECR Repositories<br/>Backend & Frontend Images<br/>Vulnerability Scanning]
            end
        end

        subgraph "AWS AI Services"
            BEDROCK[Amazon Bedrock<br/>Claude Sonnet 4<br/>Agent Management & Runtime]
            BR_KB[Bedrock Knowledge Base<br/>Vector Store & RAG]
        end

        subgraph "IAM Security"
            IAM_APPRUNNER[App Runner Role<br/>Bedrock + S3 + Secrets Access]
            IAM_ECR[ECR Access Role<br/>Container Registry Access]
        end
    end

    subgraph "External Services"
        MCP_ATLASSIAN[Atlassian MCP<br/>Jira & Confluence<br/>OAuth Protected]
        MCP_DATABRICKS[Databricks MCP<br/>Analytics Platform<br/>OAuth Protected]
    end

    %% ====================================================================================
    %% KEY DATA FLOWS & SECURITY BOUNDARIES
    %% ====================================================================================

    %% User Authentication Flow
    USERS -->|Web Browser HTTPS| AR_FE
    USERS -->|SSO Authentication| OKTA
    OKTA -->|OAuth Token| AR_BE

    %% Application Communication
    AR_FE -.->|API Calls JWT Auth| AR_BE
    AR_BE -->|Via VPC Connector| AR_CONN
    AR_CONN -->|PostgreSQL Protocol| RDS

    %% Data Storage Access
    AR_BE -->|Via VPC Endpoint| VPC_S3
    VPC_S3 -->|Private Network| S3
    AR_BE -->|IAM Role Auth| SM_SECRETS

    %% AI Service Integration
    AR_BE -->|HTTPS API Calls| BEDROCK
    BEDROCK -->|Vector Search| BR_KB

    %% External Integrations
    AR_BE -->|OAuth API Calls| MCP_ATLASSIAN
    AR_BE -->|OAuth API Calls| MCP_DATABRICKS

    %% IAM Role Assignments
    IAM_APPRUNNER -.->|Assumed By| AR_BE
    IAM_ECR -.->|Used By| ECR

    %% Network Security Controls
    SG_APPRUNNER -.->|Controls| AR_CONN
    SG_RDS -.->|Port 5432 Only| RDS

    %% ====================================================================================
    %% STYLING & VISUAL ORGANIZATION
    %% ====================================================================================

    classDef aws fill:#FF9900,stroke:#232F3E,stroke-width:2px,color:#fff,font-weight:bold
    classDef storage fill:#3F48CC,stroke:#232F3E,stroke-width:2px,color:#fff,font-weight:bold
    classDef security fill:#DD344C,stroke:#232F3E,stroke-width:2px,color:#fff,font-weight:bold
    classDef ai fill:#01A88D,stroke:#232F3E,stroke-width:2px,color:#fff,font-weight:bold
    classDef external fill:#4CAF50,stroke:#2E7D32,stroke-width:2px,color:#fff,font-weight:bold
    classDef auth fill:#F44336,stroke:#C62828,stroke-width:2px,color:#fff,font-weight:bold
    classDef user fill:#9C27B0,stroke:#6A1B9A,stroke-width:2px,color:#fff,font-weight:bold

    %% Apply Styles
    class AR_BE,AR_FE,AR_CONN,ECR aws
    class RDS,S3 storage
    class SM_SECRETS,IAM_APPRUNNER,IAM_ECR,SG_APPRUNNER,SG_RDS,VPC_S3 security
    class BEDROCK,BR_KB ai
    class MCP_ATLASSIAN,MCP_DATABRICKS external
    class OKTA auth
    class USERS user